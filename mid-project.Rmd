---
title: "基于SEIR模型的新冠疫情分析"
author: "Victor"
date: "2020/5/2"
fontsize: 12
output:
  html_document:
    toc: yes

---

# 1.研究背景及意义

## 1.1 研究背景

&emsp;&emsp;在2019年12月1日，新型冠状肺炎的已知第一例病例出现，该病例并没有直接接触华南海鲜批发市场。在2019年12月10日，第一例与华南海鲜批发市场有关的病例出现。在2019年12月12日，国家卫健委确认了武汉的首个新冠肺炎病例。2020年1月7日，专家检测出病毒为新型冠状肺炎。2020年1月15日，国家疾控中心启动一级应急响应。2020年1月20日，南山院士确认该病毒存在“有人传人，存在医务人员感染”的情况，同日，国务院将新冠肺炎纳入法定传染病。2020年1月23日上午10点武汉封城。2020年1月24日，湖北省启动突发公共卫生事件Ⅰ级响应。2020年1月29日，中国内地31个省区市全部启动突发公共卫生事件Ⅰ级响应。

&emsp;&emsp;由于新型冠状肺炎的迅速爆发以及新型冠状肺炎就有传染性，我国政府采取了封城、社区隔离、以及取消聚众活动等各项措施。但由于人民在家隔离，导致企业的日常运营无法展开，这引起了尤其是中小企业的债务危机加重，收入下降。同时，由于企业无法正常运营，使得人们对医疗物资以及生活必需品的需求得不到保障，因此，企业的复工复产就迫在眉睫。

&emsp;&emsp;为了保障人们对医疗物资和生活必需品的供应，我国开始实施复工复产政策。在2020年2月10日，上海市、重庆市、浙江省、江苏省、云南省等多个省市开始复工复产。湖北省在2月14日开始复工，新疆在2月15日开始复工，温州市在2月17日开始复工，甘肃省在2月20日开始复工。我国大多数省市都是在2月10日开始复工复产。由杨子晚报<sup>1</sup>可知，从开始复工复产到3月3日，全国（不包括港澳台地区）的复工指数已经达到57.42%，我国的37个主要城市的大多数的复工指数已经高于50%，尤其是西宁、大连、长春、沈阳、拉萨、青岛等城市，它们的复工指数均在60%以上。

## 1.2 研究意义
&emsp;&emsp;在本文中建立了SEIR模型，通过该模型对全国的高峰期进行预测，并比较在复工前，复工不采取防疫措施和复工采取防疫措施三种情况下的发展趋势，从而研究复工对疫情传播所造成的影响以及复工后采取防疫措施对疫情传播的影响，从而为我国复工后的防疫工作提供重要的参考价值。

# 2. 文献及模型理论
## 2.1 文献综述
&emsp;&emsp;数学模型能很好地揭示传染病传播的主要因素和规律。鉴于新冠肺炎的传播机理，许多学者利用SIR、SEIR和SEIAR等仓室模型来研究新冠肺炎在中国的传播、预测及控制措施评价。为疫情的控制提供了理论和科学评价依据。  
&emsp;&emsp;SEIR模型是病毒传播研究中的常用模型，它能够清晰地描述出病毒传播逻辑关系，给出较为准确的趋势预测，因而被广泛采用。徐娟年、马冉、赵中睿依据山东省2020年1月23日至3月15日的疫情数据建立SEIR模型，预测疫情的高峰期。同时，基于现有数据对未来基本再生数的变化趋势加以预测。王思远、谭瀚霖、李东杰建立一个改进的传染动力学SEIR模型用于预测湖北省COVID-2019疫情发展趋势，与现有其他 SEIR 模型不同的是，本研究通过易感人群减少率$\lambda$建模政府管控措施，较好地模拟了政府干预措施逐渐增强的现象。杨俊元、张烁、王国强、李学志利用国家公布有关新冠肺炎疫情数据直接计算SIR、SEIR和SEIAR模型的基本再生数，能克服参数估计带来的误差。曹盛力、冯沛华、时朋朋建立了联合考虑潜伏期传播能力和追踪隔离干预措施的COVID-19 SEIR传播动力学模型。  
&emsp;&emsp;本文在现有研究的基础上，通过构建修正SEIR模型，一方面考虑了潜伏期患者的传播风险,另一方面也考虑了防控隔离等手段对于疫情演化的影响。  

## 2.2模型理论一  
&emsp;&emsp;经典SEIR模型将人群分为易感者（susceptible,S）、感染者（infected,I）、潜伏者（exp osed,E)和康复人群（recovered,R）。该模型还假设人群中所有个体都有被感染的概率,当被感染个体痊愈后,会产生抗体,即康复人群R不会再被感染。考虑到防治传染病的隔离措施, 模型中的人群组别新增隔离易感者（$S_{q}$）、隔离潜伏者（$E_{q}$）和隔离感染者（$I_{q}$）。鉴于隔离感染者会立即送往定点医院隔离治疗,因此这部分人群在本模型中全部转化为住院患者$H$。因此,本文修订的模型中$S、I、E$分别指隔离措施遗漏的易感者、感染者和潜伏者。隔离易感者解除隔离后重新转变为易感者,而感染者和潜伏者均有不同程度的能力感染易感者,使其转化为潜伏者。  
&emsp;&emsp;假设隔离比例为$q$，传染概率为$\beta$，接触率为$c$，$\rho$是有效接触系数，有效接触系数的参考值取1，$\rho c$是有效接触率。易感者$S$向隔离易感者$S_{q}$、隔离潜伏者$E_{q}$、潜伏者$E$的转化速率为$\rho cq(1-\beta)$、$\rho c\beta q$ 和$\rho c\beta(1-q)$。同时考虑到非隔离的感染者$I$和潜伏者$E$对易感人群的影响，又有隔离解除的易感者$S_{q}$重新转变为$S$，因此易感者人数控制方程为  
<div align=center>  
$$ds/dt=-[\rho c\beta+\rho cq(1-\beta)]S(I+\theta E)+\lambda S_{q}\tag{1} $$
</div>  
&emsp;&emsp;其中$\theta$是潜伏者相对于感染者传播能力的比值，简单起见假设潜伏期患者与已表现出症状患者的传染能力相同，即$\theta=1$。$\lambda$是隔离解除速率，取$\lambda=1/14$（隔离时长为14d）。  
&emsp;&emsp;用于COVID-19疫情的修正SEIR动力学方程构建如下:  

$$
\left\{ 
\begin{array}{c}
    ds/dt=-[\rho c\beta+\rho cq(1-\beta)]S(I+\theta E)+\lambda S_{q} \\ 
    dE/dt=\rho c\beta(1-q)]S(I+\theta E)-\sigma E\\ 
    dI/dt=\sigma E-(\delta_{I}+\alpha+\gamma_{I})I\\
    dS_{q}/dt=\rho cq(1-\beta)]S(I+\theta E)-\lambda S_{q}\\
    dE_{q}/dt=\rho c\beta qS(I+\theta E)-\delta_{q}E_{q}\\
    dH/dt=\delta_{I}I+\delta_{q}E_{q}-(\alpha+\gamma_{H})H\\
    dR/dt=\gamma_{I}I+\gamma_{H}H
\end{array}
\right. 
\tag{2}
$$  


&emsp;&emsp;其中,$\sigma$为潜伏者向感染者的转化速率，取$\sigma=1/7$（潜伏期为7d），$\alpha$为病死率，$\delta_{I}$感染者的隔离速率，$\gamma_{I}$是感染者的恢复率.$\delta_{q}$是隔离潜伏者向隔离感染者的转化速率，$\gamma_{H}$是隔离感染者的恢复速率。  

## 2.3模型理论二  
&emsp;&emsp;在SEIR模型中，易感人群在一开始会经历潜伏期，潜伏期过后才会出现症状，并且病毒在潜伏期也具有传染性。本文针对该模型设置了4个假定：  
&emsp;&emsp;（1）只存在人传人；  
&emsp;&emsp;（2）现阶段没有治疗的特效药和疫苗；  
&emsp;&emsp;（3）不考虑外界环境因素对病死率等参数的影响；  
&emsp;&emsp;（4）忽略人口出生、死亡与国际间流动人口。  
&emsp;&emsp;模型中,全部人群（N）可分为五类：未被感染的个体易感人群（S）、与感染者密切接触过的个体潜伏人群（E）、处于感染状态且还能感染易感人群的个体-感染人群（I）、治愈出院的个体-移除人群（R）、死亡患者（D）。$S_{i}$、$E_{i}$、$I_{i}$、$R_{i}$和$D_{i}$分别表示第$i$天的易感人数、潜伏人数、感染人数、和移除人数和死亡人数。$\gamma$表示感染者康复的概率,$\beta_{1}$表示易感者的感染概率,$\beta_{2}$表示潜伏者传染给易感者的概率，$\alpha$表示潜伏者转化为感染者的概率,r1表示感染者每天接触的人数,r2表示潜伏者每天接触的人数，$k$为患者的死亡率。则有如下微分方程组:
$$
\left\{ 
\begin{array}{c}
    S_{i}=S_{i-1}-r_{1}\beta_{1}I_{i-1}S_{i-1}/N-r_{2}\beta_{2}E_{i-1}S_{i-1}/N \\ 
    E_{i}=E_{i-1}+r_{1}\beta_{1}I_{i-1}S_{i-1}/N-\alpha E_{i-1}+ r_{2}\beta_{2}E_{i-1}S_{i-1}/N\\ 
    I_{i}=I_{i-1}+\alpha E_{i-1}-(k+\gamma)I_{i-1}\\
     R_{i}=R_{i-1}+\gamma I_{i-1}\\
    D_{i}=D_{i-1}+kI_{i-1}
\end{array}
\right. 
\tag{3}
$$  
&emsp;&emsp;其中$i$表示新型冠状肺炎传播的天数，N表示总人数,$N_{i}$=$S_{i}$+$E_{i}$+$I_{i}$+$R_{i}$+$D_{i}$。
# 3. 基于修正的SEIR模型实例操作一
&#160; &#160; &#160; &#160;这一部分主要利用MATLABR软件进行修正的SEIR模型的实例操作，从以下3个方面展开：（1）无任何防控措施的疫情分析；（2）实施隔离措施后的疫情分析；（3）复工后的疫情分析。数据来源是狗熊会所整理的全国疫情数据（从1月20日开始）。

## 3.1无任何防控措施的疫情分析 
&#160; &#160; &#160; &#160;图1是从1月20日确诊第一位患者之后且期间没有任何措施的疫情趋势图。这里需要估计的参数估计值来自相关的参考文献。

&#160; &#160; &#160; &#160;参数设定如下：
$$
\begin{align}
全国总人口数&：N=1400050000\\
全国平均感染概率&：\beta=0.6225\\
全国康复概率&：\gamma=0.30\\
全国死亡率&:K=0.03\\
潜伏者转换为传染者概率&：a=0.125\\
平均接触概率&：r=10
\end{align}
$$
&#160; &#160; &#160; &#160;这里全国总人口数$N$是中国统计局官网上的2019年年末总人口数；全国的平均感染率$\beta$来自于黄森忠教授的文章(新型冠状病毒肺炎疫情控制策略研究：效率评估及建议)；康复率$\gamma$和死亡率$k$由康复人数、死亡人数和确诊人数计算得到,转换概率$a$由感染人数和潜伏人数计算得到，这些计算方法来自于徐娟年的文章（山东省新型冠状病毒肺炎疫情流行趋势的初步预测）；平均接触率$r$大多数文献是自己设定的，所以这里选择了较常用的10。

&#160; &#160; &#160; &#160;结果如下：

<center>![1.情况.png](https://i.loli.net/2020/05/07/JLWxe3FknbR4Ddq.png)<center>

由上图可以看出，在不实施任何防控隔离措施的情况下，疫情走势非常严峻，感染人数最高达到了一亿人。

## 3.2实施隔离措施后的疫情分析 
&#160; &#160; &#160; &#160;这里考虑了实施隔离后的疫情走势。图2是1月20日确诊第一位患者后，假定7天后全国开始采取隔离措施（1月23日武汉封城，其他省市也相应作出隔离措施）的疫情趋势图。由于这里考虑了隔离措施，所以全国的平均接触率有所下降，设置$r_2=5$。

&#160; &#160; &#160; &#160;结果如下：

<center>![2.1隔离措施.png](https://i.loli.net/2020/05/07/aS9NL6zfgVdbHY2.png)<center>

<center>![2.2细节.png](https://i.loli.net/2020/05/07/CiwAdek8U2GxapH.png)<center>

上面的第一幅图是实施隔离措施后的疫情走势，第二幅图是第一幅图的局部细节图。与不实施任何防控隔离措施的图对比，可以明显看出，感染人数在实施隔离措施后得到控制，峰值出现在2月25日左右（实际峰值在2月18日左右出现），尤其在4月28日时预测的感染人数大约为230人，而实际上4月28日的感染人数为647人。之所以这里预测的人数比实际少很大程度上是因为之后全国进行了复工复产。

## 3.3 复工后的疫情分析
&#160; &#160; &#160; &#160;这一部分考虑了复工情况对疫情的影响。图3是1月20日确诊第一位患者后，假定7天后全国开始采取隔离措，2月10日复工的疫情趋势图。设置复工后的全国的平均接触率$r_3=8$。

&#160; &#160; &#160; &#160;结果如下：

<center>![3.1复工后.png](https://i.loli.net/2020/05/07/FiBySZELmKXG6tu.png)<center>

<center>![3.2细节.png](https://i.loli.net/2020/05/07/KYxjwLBczXuFDhy.png)<center>

上面的第一幅图是复工复产后的疫情走势，第二幅图是第一幅图的局部细节图。可以看到峰值在2月20左右出现，与实际峰值较为接近，且在4月28日时预测的感染人数大约为500人，与实际值也较为接近。

# 4.基于修正的SEIR模型实例操作二
## 4.1 参数与变量设定

参数|$c$|$\delta_{I}$|$\delta_{q}$|$\gamma_{I}$|$\gamma_{H}$|$\beta$|$q$|$\alpha$
:----:|:----:| :----: | :----: | :----: | :----: | :----: | :----: | :----: 
| |接触率|感染者隔离速率|隔离潜伏者向隔离感染者的转化速率|恢复率|恢复速率|传染概率|隔离比例|病死率
取值|$2$|$0.13$|$0.13$|$0.007$|$0.014$|$2.05\times10^{-9}$|$1.0\times10^{-6}$|$2.7\times10^{-4}$


|变量|$S$|$E$|$I$|$S_{q}$|$E_{q}$|$H$|$R$|
|:----:|:----:| :----: | :----: | :----: | :----: | :----: | :----: |
| |易感者|潜伏者|感染者|隔离易感者|隔离潜伏者|住院患者|康复人群|
|取值|$5917万$|$4007$|$786$|$2776$|$400(估)$|$I+E_{q}$|$31$|


## 4.2 潜伏期患者是否具有传染性理论估计分析
其中$\theta$是潜伏者相对于感染者传播能力的比值，$\theta=1$代表潜伏期患者与已表现出症状患者的传染能力相同。$\theta=0$代表潜伏期患者不具有传染能力。而当$\theta=1$ （即考虑潜伏期患者具有传染力）时，模型理论估计得到的湖北省感染人数略高于湖北省实际感染人数，但整体趋势吻合，故后续模型在$\theta=1$的基础上建立。

<center>![](https://i.loli.net/2020/05/07/JYPW3NOtUrHgpK5.png)<center>

## 4.3 防控隔离对疫情影响预测
根据突发公共卫生事件处理需要，湖北省启动了必要的防空隔离措施，如限制多人聚集、对流动人口采取预防措施等。实质上是为了降低日常接触率（$c$）。模型中设定当前防控隔离措施下接触率$c=2$。通过对$c$进行调整，预测若降低防空隔离力度，评估当前的隔离效果。若政府早2020年1月23日没有实施适当的防控隔离措施，湖北感染人数可能达到当前的2倍以上。

<center>![](https://i.loli.net/2020/05/07/pIBnDayMljFRgUQ.png)<center>

## 4.4 追踪隔离对疫情影响预测
对于疫情的控制，湖北省实行了严格的医学追踪隔离（对于密切接触者进行为期14天的隔离观察）。将隔离比例（$q$）下降为0.9、0.8、0.6倍时，感人人数的上升速度与峰值都会增加，特别是当隔离比例降低为$0.6q$时，感染人数的峰值变为原来的2倍左右。

<center>![](https://i.loli.net/2020/05/07/RefSt28EgcUlTuv.png)<center>

## 4.5 个人防护对疫情影响预测
个人有效接触率为$c^{'}=\rho*c$，其中$\rho$为有效接触系数。为了方便模拟，设置人员之间的接触率$c=10$，$\rho=1、0.5、0.25、0.1$分别代表日常防控、2倍防控、4倍防控以及严格防控。可见加强自我防控可以降低感染人数峰值，特别是严格的自我防控（$\rho=0.1$）时感染人数峰值降为原来的50%左右。

<center>![](https://i.loli.net/2020/05/07/OExJeQC5WpcsVr3.png)<center>

# 5. 参数估计方法

## 5.1 极大似然估计法

&emsp;&emsp;极大似然法，也称最大似然法，最早由德国数学家高斯于1821年提出，在1912，英国统计学家罗纳德费歇尔再次提出了此方法的思想，并证明了该方法的一些性质。

&emsp;&emsp;极大似然法是不同于普通最小二乘法的另一种参数估计方法，它是从极大似然原理出发发展起来的其他参数估计方法的基础。普通最小二乘法是当从模型总体中随机抽取n组样本观测值后，最合理的参数估计量应该使得此模型能最好地拟合样本数据；而对于极大似然法，是当从模型总体中随机抽取 n 组样本观测值后，最合理的参数估计量应该使得从此模型中抽取该n组样本观测值的概率最大。因此，极大似然原理比最小二乘原理更本质地揭示了通过样本估计总体参数的内在机理，在参数估计中占据着重要的地位。
&emsp;&emsp;这里通过线性回归模型实例来介绍极大似然估计的思想。对于一元线性回归模型$Y=\beta_0 + \beta_1X + \mu$，随机抽取n组样本观测值${{(X_i,Y_i):i=1,2,...,n}}$,由于$Y_i$服从如下正态分布：
$$
Y_i\sim N(\beta_0 + \beta_1X_i, \delta^2)
$$
&emsp;&emsp;于是，$Y_i$的概率函数为
$$
P(Y_i)=\frac{1}{\delta \sqrt{2\pi}}exp\{-\frac{1}{2\delta^2}(Y_i-\beta_0 - \beta_1X_i)^2\}, i=1,2,\cdots,n
$$
&emsp;&emsp;因为$\{Y_i,i=1,2,\cdots,n\}$是相互独立的，所以Y的所有样本观测值得联合概率密度，即似然函数为：
$$
L(\beta_0,\beta_1,\delta^2)=P(Y_1,Y_2,\cdots,Y_n)=\frac{1}{(2\pi)^{\frac{n}{2}}\delta^2}exp\{{-\frac{1}{2\delta^2}}\Sigma(Y_i-\beta_0-\beta_1X_i)^2\}
$$
&emsp;&emsp;将该似然函数最大化，即可求出模型参数的极大似然估计量。
&emsp;&emsp;由于似然函数的极大化与似然函数对数的极大化是等价的，所以对数似然函数如下：
$$
L^*=lnL=-nln(\sqrt{2\pi}\delta )-\frac{1}{2\delta^2}\Sigma(Y_i-\beta_o-\beta_1X_i)^2
$$
&emsp;&emsp;对$L^*$求极大值，等价于对$\Sigma(Y_i-\beta_o-\beta_1X_i)^2$求极小值。设$\hat{\beta_0}$,$\hat{\beta_1}$满足该极值条件，即
$$
\frac{\partial}{\partial\hat{\beta_0}}\Sigma(Y_i-\beta_o-\beta_1X_i)^2=0
$$
$$
\frac{\partial}{\partial\hat{\beta_1}}\Sigma(Y_i-\beta_o-\beta_1X_i)^2=0
$$
&emsp;&emsp;解得模型的参数估计量为：
$$
\hat{\beta_0}=\frac{\Sigma X_i^2 \Sigma Y_i - \Sigma X_i \Sigma Y_iX_i}{n\Sigma X_i^2-(\Sigma X_i)^2}
$$
$$
\hat{\beta_1}=\frac{n\Sigma Y_iX_i - \Sigma Y_i \Sigma X_i}{n\Sigma X_i^2-(\Sigma X_i)^2}
$$
## 5.2 基于SEIR模型的疫情分析-极大似然函数法

&emsp;&emsp;对于SEIR模型，我们根据新冠疫情的发展，做出以下假设：

&emsp;&emsp;(1)假设易感者为总人口规模的10%，即$N=1.4\times10^8$，初始只有一个感染者，没有潜伏者，也没有移出者，即初始状态空间为$C_0=(S_0,E_0,I_0,R_0)=(N-1,0,1,0)$;

&emsp;&emsp;(2)根据其他学者研究，设定平均潜伏期为4.98天，即$\frac{1}{\delta}=4.98$,平均感染期为7.04天，即$\frac{1}{\gamma}=7.04$;

&emsp;&emsp;(3)假定控制措施在1月23日开始实施。

&emsp;&emsp;(4)假设病人的累计人数服从泊松分布。

&emsp;&emsp;同时，假定在控制措施实施之前，传染率是恒定不变的常数$\beta$，在控制措施实施之后，传染率呈指数下降，即传染率$\beta(t)=\beta e^{[-k(t-\tau)]}$，其中$k$为一个控制系数。

&emsp;&emsp;在给定初始状态的情况下，结合SEIR模型、极大似然估计法和Nelder-Mead最优算法，对待估参数进行估计。
对于极大似然估计法，我们通过病例的累计人数C服从泊松分布来建立似然函数：
$$
L=\Sigma \frac{\hat{C}^c}{C!}e^{-\hat{C}}
$$
&emsp;&emsp;其中$\hat{C}$表示病例累计人数的模拟序列，C表示病例累计人数的原始序列。

### 5.2.1 参数估计结果
&emsp;&emsp;根据SEIR微分方程模型，采用极大似然估计法，并结合 Nelder-Mead 最优算法，得出新冠肺炎在全国范围内爆发的传染率$\beta$为0.618,并由此得出基本再生数$R_0$,基本再生数$R_0$表示在干预之前，完全易感人群中一个病例在整个传染期内平均感染的人数，即$R_0 = \beta/\gamma$,经计算，国内疫情的基本再生数$R_0$为4.35。由此可以看出，在国家实施控制措施之前，新冠肺炎会继续蔓延而形成疫情的大流行，此时只有政府实施控制措施使其降至1以下时，新冠肺炎才会得到有效控制，并最终慢慢消失。

### 5.2.2 有效再生数分析
&emsp;&emsp;对于控制系数$k$来说，在全国疫情发展下，控制系数$k$为0.0723。$k>0$说明政府的控制措施能够有效的抑制新冠肺炎的传播。为了更好的体现控制措施干预后埃博拉病毒的传播过程是否得到抑制，可以通过有效再生数指标来进一步体现，根据有效再生数的定义计算得出有效再生数$R(t)$为$4.35e^{(-0.0723t)}$，可以看出其呈指数下降，下降到1的日期在2020年2月12日，如图1所示。这表明在SEIR模型下，政府的控制干预措施对新冠疫情发展的抑制作用是有效的。

<div align=center>![图1](https://i.loli.net/2020/05/08/pvblFjWdqV5sYhr.jpg)</div>

### 5.2.3 拟合曲线分析

&emsp;&emsp;通过对上述参数的估计及分析，利用参数的估计值，结合SEIR模型模拟出新冠肺炎病例的累计人数的拟合值，并做出相应的曲线与真实观测值进行对比，如图2所示。我们发现疫情真实发展的观测值与拟合值得发展趋势基本一致，拟合曲线基本吻合，这表明SEIR模型对全国疫情的传播机制和传播速度都能够给出有效的解释和说明。

<div align=center>![图2](https://i.loli.net/2020/05/08/dLEBoPJu7XbFAcz.jpg)</div>


## 5.3模拟退火算法

&emsp;&emsp;SEIR模型由微分方程组构成，若已知疫情传播的初始状态，并给定模型参数集$P=(\beta,\delta,\gamma)\in R^3$,便可利用四阶龙格-库塔方法解析得到相对的疫情传播过程，及各个时刻t的$S(t),E(t),I(t),R(t)$,现在已知每天新增的病例数，而反应疫情传播特征的参数未知。因此可以利用模拟退火算法对参数进行优化求解。模拟退火算法的目标函数$loss$设置如下：
$$
loss=\frac{\sqrt{\sum_{i=1}^{N}(obs_i - est_i)^2}}{(\sqrt{\sum_{i=1}^{N}obs_i^2}+\sqrt{\sum_{i=1}^{N}est_i^2})}
$$
&emsp;&emsp;其中，$obs_i$为实际的每天新增的病例数，$est_i$为模拟得到的每日新增病例数。
&emsp;&emsp;模拟退火算法模型参数的优化过程如图3：

<div align=center>![图3](https://i.loli.net/2020/05/07/4RBGX76FwD9KLMf.jpg)</div>

### 5.3.2模拟退火算法的原理

&emsp;&emsp;在目标函数给定之后，如果想要求函数的全局最优解，如图4所示，如果采用Greedy策略，那么从A点开始试探，如果函数值继续减少，那么试探过程就会继续。而当到达点B时，显然我们的探求过程就结束了（因为无论朝哪个方向努力，结果只会越来越大）。最终我们只能找打一个局部最后解B。

<div align=center>![图4](https://i.loli.net/2020/05/07/EAwCb537qGKWTcn.jpg) </div>

&emsp;&emsp;模拟退火其实也是一种Greedy算法，但是它的搜索过程引入了随机因素。模拟退火算法以一定的概率来接受一个比当前解要差的解，因此有可能会跳出这个局部的最优解，达到全局的最优解。以上图为例，模拟退火算法在搜索到局部最优解B后，会以一定的概率接受向右继续移动。也许经过几次这样的不是局部最优的移动后会到达B 和C之间的峰点，于是就跳出了局部最小值B。

&emsp;&emsp;根据Metropolis准则，粒子在温度T时趋于平衡的概率为exp(-ΔE/(kT))，其中E为温度T时的内能，ΔE为其改变数,k为Boltzmann常数。Metropolis准则常表示为

<div align=center>![](https://i.loli.net/2020/05/07/uzTxRmNbQkSwPe4.jpg)</div>

&emsp;&emsp;Metropolis准则表明，在温度为T时，出现能量差为dE的降温的概率为P(dE)，表示为：P(dE) = exp( dE/(kT) )。其中k是一个常数，exp表示自然指数，且dE<0。所以P和T正相关。这条公式就表示：温度越高，出现一次能量差为dE的降温的概率就越大；温度越低，则出现降温的概率就越小。又由于dE总是小于0（因为退火的过程是温度逐渐下降的过程），因此dE/kT < 0 ，所以P(dE)的函数取值范围是(0,1) 。随着温度T的降低，P(dE)会逐渐降低。

&emsp;&emsp;我们将一次向较差解的移动看做一次温度跳变过程，我们以概率P(dE)来接受这样的移动。也就是说，在用固体退火模拟组合优化问题，将内能E模拟为目标函数值 f，温度T演化成控制参数t，即得到解组合优化问题的模拟退火演算法：由初始解 i 和控制参数初值 t 开始，对当前解重复“产生新解→计算目标函数差→接受或丢弃”的迭代，并逐步衰减 t 值，算法终止时的当前解即为所得近似最优解，这是基于蒙特卡罗迭代求解法的一种启发式随机搜索过程。退火过程由冷却进度表(Cooling Schedule)控制，包括控制参数的初值 t 及其衰减因子Δt 、每个 t 值时的迭代次数L和停止条件S。

&emsp;&emsp;总结起来就是：

&emsp;&emsp;(1)若f( Y(i+1) ) <= f( Y(i) )(即移动后得到更优解)，则总是接受该移动；

&emsp;&emsp;(2)若f( Y(i+1) ) > f( Y(i) )(即移动后的解比当前解要差)，则以一定的概率接受移动，而且这个概率随着时间推移逐渐降低（逐渐降低才能趋向稳定）相当于上图中，从B移向BC之间的小波峰时，每次右移（即接受一个更糟糕值）的概率在逐渐降低。如果这个坡特别长，那么很有可能最终我们并不会翻过这个坡。如果它不太长，这很有可能会翻过它，这取决于衰减 t 值的设定。
